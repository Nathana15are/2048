<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>2048 Cyberpunk ULTRA Deluxe</title>
  <style>
    body {
      margin: 0;
      font-family: "Orbitron", sans-serif;
      background: black;
      color: #0ff;
      text-align: center;
      overflow: hidden;
    }
    canvas#matrix {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      z-index:-1;
      background: black;
    }
    h1 {
      text-shadow: 0 0 10px #0ff, 0 0 20px #f0f;
    }
    #scoreboard {
      margin: 10px;
      font-size: 18px;
      text-shadow: 0 0 10px #0ff;
    }
    #game-container {
      width: 400px;
      height: 400px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 5px;
      background: rgba(10,10,20,0.8);
      padding: 5px;
      border: 3px solid #0ff;
      box-shadow: 0 0 20px #0ff;
    }
    .tile {
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      font-weight: bold;
      border-radius: 6px;
      background: rgba(0, 255, 255, 0.1);
      color: #fff;
      transition: 0.2s;
    }
    .tile.locked {
      background: rgba(255,0,0,0.5) !important;
      text-decoration: line-through;
    }
    #achievements {
      margin-top: 10px;
      font-size: 16px;
      color: #ff0;
      text-shadow: 0 0 10px #ff0;
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>
  <h1>2048 Cyberpunk ULTRA Deluxe ‚ö°</h1>
  <div id="scoreboard">Score: <span id="score">0</span> | Highscore: <span id="highscore">0</span></div>
  <div id="game-container"></div>
  <div id="achievements">Succ√®s : aucun</div>

  <script>
    /* ==============================
       FOND ANIM√â STYLE MATRIX
    ============================== */
    const canvas = document.getElementById("matrix");
    const ctx = canvas.getContext("2d");
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    const letters = "01";
    const fontSize = 14;
    const columns = canvas.width/fontSize;
    const drops = Array(Math.floor(columns)).fill(1);
    function drawMatrix() {
      ctx.fillStyle = "rgba(0,0,0,0.1)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "#0f0";
      ctx.font = fontSize + "px monospace";
      for(let i=0;i<drops.length;i++){
        let text = letters.charAt(Math.floor(Math.random()*letters.length));
        ctx.fillText(text,i*fontSize,drops[i]*fontSize);
        if(drops[i]*fontSize>canvas.height && Math.random()>0.975){
          drops[i]=0;
        }
        drops[i]++;
      }
    }
    setInterval(drawMatrix,33);

    /* ==============================
       JEU 2048 DELUXE
    ============================== */
    const size = 4;
    let board = [];
    let score = 0;
    let highscore = localStorage.getItem("highscore2048deluxe") || 0;
    let hardcoreBlocks = [];
    let achievements = [];

    document.getElementById("highscore").textContent = highscore;

    function initBoard() {
      board = Array(size).fill().map(()=>Array(size).fill(0));
      score=0;
      hardcoreBlocks=[];
      achievements=[];
      addRandomTile();
      addRandomTile();
      drawBoard();
    }

    function addRandomTile() {
      let empty = [];
      for (let r=0;r<size;r++){
        for (let c=0;c<size;c++){
          if(board[r][c]===0) empty.push({r,c});
        }
      }
      if(empty.length){
        let {r,c} = empty[Math.floor(Math.random()*empty.length)];
        // Boss tile chance
        let chance = Math.random();
        if(chance<0.05) board[r][c] = 128;
        else board[r][c] = Math.random()<0.9 ? 2 : 4;
      }
      // Hardcore: lock une case au hasard
      if(Math.random()<0.05){
        let r = Math.floor(Math.random()*size);
        let c = Math.floor(Math.random()*size);
        hardcoreBlocks.push(r+"-"+c);
      }
      // Roulette: change une case au hasard
      if(Math.random()<0.1){
        let r = Math.floor(Math.random()*size);
        let c = Math.floor(Math.random()*size);
        if(board[r][c]>0) board[r][c]*=2;
      }
    }

    function drawBoard() {
      const container = document.getElementById("game-container");
      container.innerHTML = "";
      for(let r=0;r<size;r++){
        for(let c=0;c<size;c++){
          let value = board[r][c];
          let tile = document.createElement("div");
          tile.className = "tile";
          if(value>0){
            tile.dataset.value=value;
            tile.textContent=value;
            tile.style.boxShadow=`0 0 ${value/4}px ${value/64+2}px hsl(${value*10%360},100%,50%)`;
            tile.style.color=`hsl(${(value*20)%360},100%,70%)`;
          }
          if(hardcoreBlocks.includes(r+"-"+c)){
            tile.classList.add("locked");
          }
          container.appendChild(tile);
        }
      }
      document.getElementById("score").textContent=score;
      checkAchievements();
    }

    function playSound(value){
      let url="";
      if(value<16) url="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg";
      else if(value<128) url="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg";
      else if(value<512) url="https://actions.google.com/sounds/v1/cartoon/concussive_hit_guitar_boing.ogg";
      else if(value<2048) url="https://actions.google.com/sounds/v1/cartoon/metal_clang.ogg";
      else url="https://actions.google.com/sounds/v1/cartoon/woodpecker_pecking.ogg";
      new Audio(url).play();
    }

    function addParticles(x,y,color){
      for(let i=0;i<10;i++){
        let p=document.createElement("div");
        p.style.position="absolute";
        p.style.width="4px";p.style.height="4px";
        p.style.left=(x+Math.random()*40)+"px";
        p.style.top=(y+Math.random()*40)+"px";
        p.style.background=color;
        p.style.borderRadius="50%";
        p.style.opacity="1";
        p.style.zIndex="999";
        document.body.appendChild(p);
        let dx=(Math.random()-0.5)*4;
        let dy=(Math.random()-0.5)*4;
        let life=30;
        let interval=setInterval(()=>{
          p.style.left=(parseFloat(p.style.left)+dx)+"px";
          p.style.top=(parseFloat(p.style.top)+dy)+"px";
          p.style.opacity=parseFloat(p.style.opacity)-0.03;
          if(--life<=0){clearInterval(interval);p.remove();}
        },30);
      }
    }

    function slide(row) {
      row = row.filter(v => v);
      for (let i=0;i<row.length-1;i++){
        if(row[i]===row[i+1]){
          row[i]*=2;
          score+=row[i];
          playSound(row[i]);
          addParticles(Math.random()*400+200,Math.random()*400+200,"#0ff");
          if(row[i]===2048) glitchEffect();
          row[i+1]=0;
        }
      }
      row=row.filter(v=>v);
      while(row.length<size) row.push(0);
      return row;
    }

    function rotate(board){
      return board[0].map((_,i)=>board.map(row=>row[i]).reverse());
    }

    function move(direction){
      let oldBoard=JSON.stringify(board);
      for(let i=0;i<direction;i++) board=rotate(board);
      board=board.map(slide);
      for(let i=0;i<(4-direction)%4;i++) board=rotate(board);
      if(JSON.stringify(board)!==oldBoard){
        addRandomTile();
      }
      drawBoard();
      if(score>highscore){
        highscore=score;
        localStorage.setItem("highscore2048deluxe",highscore);
        document.getElementById("highscore").textContent=highscore;
      }
    }

    document.addEventListener("keydown", e=>{
      if(e.key==="ArrowLeft") move(0);
      else if(e.key==="ArrowUp") move(1);
      else if(e.key==="ArrowRight") move(2);
      else if(e.key==="ArrowDown") move(3);
    });

    /* ==============================
       SUCC√àS
    ============================== */
    function checkAchievements(){
      let list=[];
      if(score>=256) list.push("üî• 256 atteint !");
      if(score>=1024) list.push("‚ö° 1024 atteint !");
      if(score>=2048) list.push("üëæ 2048 atteint !");
      document.getElementById("achievements").textContent="Succ√®s : "+(list.length?list.join(" | "):"aucun");
    }

    /* ==============================
       EFFET GLITCH
    ============================== */
    function glitchEffect(){
      let body=document.body;
      let i=0;
      let interval=setInterval(()=>{
        body.style.transform=`skew(${(Math.random()-0.5)*20}deg)`;
        if(i++>5){clearInterval(interval);body.style.transform="";}
      },100);
    }

    initBoard();
  </script>
</body>
</html>
