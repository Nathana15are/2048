
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>2048 Cyberpunk ULTRA Deluxe</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    #game-container {
      background: rgba(0,0,0,0.6);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px #0ff;
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
    }
    #score {
      margin-bottom: 15px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(4, 80px);
      grid-gap: 10px;
      justify-content: center;
      margin: 0 auto;
    }
    .tile {
      width: 80px;
      height: 80px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      font-weight: bold;
      border-radius: 6px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      transition: transform 0.1s;
    }
    .tile.spawn {
      animation: spawn 0.3s ease;
    }
    @keyframes spawn {
      from {transform: scale(0);}
      to {transform: scale(1);}
    }
    #message {
      margin-top: 10px;
      font-size: 18px;
      color: #0ff;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>2048 Cyberpunk ULTRA Deluxe</h1>
    <div id="score">Score: <span id="score-value">0</span> | Record: <span id="highscore-value">0</span></div>
    <div id="grid"></div>
    <div id="message"></div>
  </div>

  <script>
    const gridSize = 4;
    let grid = [];
    let score = 0;
    let highscore = localStorage.getItem("highscore") || 0;

    const gridElement = document.getElementById("grid");
    const scoreElement = document.getElementById("score-value");
    const highscoreElement = document.getElementById("highscore-value");
    const messageElement = document.getElementById("message");

    highscoreElement.textContent = highscore;

    function init() {
      grid = Array(gridSize).fill().map(() => Array(gridSize).fill(0));
      score = 0;
      updateScore();
      spawnTile();
      spawnTile();
      draw();
    }

    function spawnTile() {
      let empty = [];
      for (let r=0;r<gridSize;r++){
        for (let c=0;c<gridSize;c++){
          if (grid[r][c] === 0) empty.push({r,c});
        }
      }
      if (empty.length > 0) {
        let {r,c} = empty[Math.floor(Math.random()*empty.length)];
        grid[r][c] = Math.random() < 0.9 ? 2 : 4;
      }
    }

    function draw() {
      gridElement.innerHTML = "";
      for (let r=0;r<gridSize;r++){
        for (let c=0;c<gridSize;c++){
          const tile = document.createElement("div");
          tile.classList.add("tile");
          let value = grid[r][c];
          if (value > 0) {
            tile.textContent = value;
            tile.style.background = getColor(value);
          }
          gridElement.appendChild(tile);
        }
      }
    }

    function getColor(value) {
      const colors = {
        2: "#0ff",
        4: "#0f0",
        8: "#ff0",
        16: "#f0f",
        32: "#f80",
        64: "#f00",
        128: "#08f",
        256: "#0fa",
        512: "#af0",
        1024: "#fa0",
        2048: "#fff",
      };
      return colors[value] || "#888";
    }

    function slide(row) {
      row = row.filter(val => val);
      for (let i=0;i<row.length-1;i++){
        if (row[i] === row[i+1]) {
          row[i] *= 2;
          playSound(row[i]);
          score += row[i];
          row[i+1] = 0;
        }
      }
      row = row.filter(val => val);
      while (row.length < gridSize) row.push(0);
      return row;
    }

    function moveLeft() {
      for (let r=0;r<gridSize;r++){
        let row = grid[r];
        row = slide(row);
        grid[r] = row;
      }
    }

    function rotateGrid() {
      let newGrid = Array(gridSize).fill().map(() => Array(gridSize).fill(0));
      for (let r=0;r<gridSize;r++){
        for (let c=0;c<gridSize;c++){
          newGrid[r][c] = grid[c][gridSize-1-r];
        }
      }
      grid = newGrid;
    }

    function move(dir) {
      for (let i=0;i<dir;i++) rotateGrid();
      moveLeft();
      for (let i=0;i<(4-dir)%4;i++) rotateGrid();
      spawnTile();
      draw();
      updateScore();
      checkWin();
    }

    function checkWin() {
      for (let r=0;r<gridSize;r++){
        for (let c=0;c<gridSize;c++){
          if (grid[r][c] === 2048) {
            messageElement.textContent = "ðŸ”¥ BRAVO tu as atteint 2048 !!! ðŸ”¥";
            glitch();
          }
        }
      }
    }

    function updateScore() {
      scoreElement.textContent = score;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
        highscoreElement.textContent = highscore;
      }
    }

    function playSound(value) {
      let context = new (window.AudioContext || window.webkitAudioContext)();
      let o = context.createOscillator();
      let g = context.createGain();
      o.connect(g);
      g.connect(context.destination);
      o.type = "sawtooth";
      o.frequency.setValueAtTime(200 + value, context.currentTime);
      g.gain.setValueAtTime(0.05, context.currentTime);
      o.start();
      o.stop(context.currentTime + 0.1);
    }

    function glitch() {
      document.body.style.animation = "glitch 0.5s";
      setTimeout(() => { document.body.style.animation = ""; }, 500);
    }

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") move(0);
      else if (e.key === "ArrowUp") move(1);
      else if (e.key === "ArrowRight") move(2);
      else if (e.key === "ArrowDown") move(3);
    });

    init();
  </script>
</body>
</html>
